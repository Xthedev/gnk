// Import.
const assert = require('assert');
const JsonRecords = require('../index');

// Constants.
const TEST_FILE_PATH = './tests/temp/main.json';

/**
 * Check adding.
 */
describe('Check adding.', () => {
  it('Should contain 1 object with property "w" that equals 9.', () => {
    const jr = initTestRecords();
    jr.add({ q: 9 });
    const records = jr.get(v => v.q === 9);
    assert.equal(records.length, 1);
  });
});

/**
 * Check removing.
 */
describe('Check removing.', () => {
  it('Should not contain objects with property "a" that equals 1.', () => {
    const jr = initTestRecords();
    jr.remove(v => v.a === 1);
    const records = jr.get(v => v.a === 1);
    assert.equal(records.length, 0);
  });
});

/**
 * Check updating.
 */
describe('Check updating.', () => {
  it('Should contain 2 objects with property "c" that equals 8.', () => {
    const jr = initTestRecords();
    jr.update(v => v.a === 1, { c: 8 });
    const records = jr.get(v => v.c === 8);
    assert.equal(records.length, 2);
  });
});

/**
 * Check adding with async saving.
 */
describe('Check adding with async saving.', () => {
  it('Should contain 1 object with property "w" that equals 9.', () => {
    const jr = initTestRecordsWithAsyncSaving();
    jr.add({ q: 9 });
    const records = jr.get(v => v.q === 9);
    assert.equal(records.length, 1);
  });
});

/**
 * Check removing with async saving.
 */
describe('Check removing with async saving.', () => {
  it('Should not contain objects with property "a" that equals 1.', () => {
    const jr = initTestRecordsWithAsyncSaving();
    jr.remove(v => v.a === 1);
    const records = jr.get(v => v.a === 1);
    assert.equal(records.length, 0);
  });
});

/**
 * Check updating with async saving.
 */
describe('Check updating with async saving.', () => {
  it('Should contain 2 objects with property "c" that equals 8.', () => {
    const jr = initTestRecordsWithAsyncSaving();
    jr.update(v => v.a === 1, { c: 8 });
    const records = jr.get(v => v.c === 8);
    assert.equal(records.length, 2);
  });
});

/**
 * Init test records.
 * @return {JsonRecords}
 */
function initTestRecords() {
  const jr = new JsonRecords(TEST_FILE_PATH);
  jr.remove();
  jr.add({ a: 1, b: 2, c: 3 });
  jr.addBulk([{ a: 1, b: 2, c: 3 }, { a: 4, b: 5, c: 6 }]);
  return jr;
}

/**
 * Init test records with async saving.
 * @return {JsonRecords}
 */
function initTestRecordsWithAsyncSaving() {
  const jr = new JsonRecords(TEST_FILE_PATH, { async: true, asyncTimeout: 500, logs: false });
  jr.remove();
  jr.add({ a: 1, b: 2, c: 3 });
  jr.add({ a: 1, b: 2, c: 3 });
  jr.add({ a: 4, b: 5, c: 6 });
  return jr;
}
